{# SysGov_Project/integracao_audesp/templates/integracao_audesp/listar_submissoes.html #}
{% extends 'base.html' %} {# Altere para o seu template base principal, se for diferente #}
{% load static %}
{% load widget_tweaks %}

{% block title %}{{ titulo_pagina }}{% endblock title %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{{ titulo_pagina }}</h1>
        {# Você pode adicionar botões de ação aqui, como "Gerar Nova Submissão" #}
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tipo de Documento</th>
                    <th>Objeto Vinculado</th>
                    <th>Status</th>
                    <th>Data/Hora da Submissão</th>
                    <th>Enviado Por</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for submissao in submissoes %}
                <tr>
                    <td>{{ submissao.pk }}</td>
                    <td>{{ submissao.get_tipo_documento_display }}</td>
                    <td>
                        {% if submissao.content_object %}
                            {{ submissao.content_object }}
                            {# Adicionar link para o detalhe do objeto vinculado, se for útil #}
                            {% if submissao.tipo_documento == 'EDL' and submissao.content_object.pk %}
                                (<a href="{% url 'licitacoes:detalhar_edital' pk=submissao.content_object.pk %}">Detalhes Edital</a>)
                            {% elif submissao.tipo_documento == 'AJT' and submissao.content_object.pk %}
                                {# <<< ESTE É O LINK PARA A NOVA PÁGINA DE DETALHES DA ATA/AJUSTE CONTRATUAL >>> #}
                                (<a href="{% url 'integracao_audesp:detalhar_ajuste_contratual_audesp' pk=submissao.content_object.pk %}">Detalhes Ata</a>)
                            {% endif %}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>{{ submissao.get_status_display }}</td>
                    <td>{{ submissao.data_submissao|date:"d/m/Y H:i" }}</td>
                    <td>{{ submissao.enviado_por.username|default:"N/A" }}</td>
                    <td>
                        {# Botão para visualizar JSON, se for o caso #}
                        {% if submissao.tipo_documento == 'EDL' %}
                            <a href="{% url 'integracao_audesp:gerar_edital_audesp_json' edital_id=submissao.content_object.pk %}" class="btn btn-sm btn-outline-primary" target="_blank">Ver JSON Edital</a>
                        {% elif submissao.tipo_documento == 'AJT' %}
                            <a href="{% url 'integracao_audesp:gerar_ajuste_contratual_audesp_json' ajuste_id=submissao.content_object.pk %}" class="btn btn-sm btn-outline-info" target="_blank">Ver JSON Ata</a>
                        {% endif %}
                        {# Adicione mais botões de ação aqui, como download de arquivo gerado #}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7">Nenhuma submissão AUDESP encontrada.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock content %}